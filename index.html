<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·Äù·Ä±·Äö·Ä∂·Åè ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÖ·Äê·Ä≠·ÄØ·Ä∏ (Firestore ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫)</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter ·ÄÖ·Ä¨·Äú·ÄØ·Ä∂·Ä∏·Äï·ÄØ·Ä∂·ÄÖ·Ä∂·ÄÄ·Ä≠·ÄØ ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s, color 0.4s;
        }
        .app-card {
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-color 0.3s, background-color 0.4s;
            border: 1px solid transparent;
        }
        .app-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
            border-color: #06b6d4;
        }
        #screenshot-carousel {
            scroll-behavior: smooth;
        }
        /* Dark Mode Overrides for deeper contrast */
        .dark .bg-gray-50 { background-color: #0f172a; } 
        .dark .bg-white { background-color: #1e293b; } 
        .dark .app-card { background-color: #334155; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-slate-900 text-gray-900 dark:text-gray-50 min-h-screen">

    <div id="app-container" class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8 py-2 sm:py-4">
        <!-- ·Äí·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Äô·ÄÖ·Ä∫ ·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨·Äô·Äª·Ä¨·Ä∏ ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·Ä±·Ä´·Ä∫·Äú·Ä¨·Äô·Ää·Ä∫ -->
    </div>

    <!-- JavaScript ·Äú·Ä±·Ä¨·Ä∑·ÄÇ·Äª·ÄÖ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Firebase ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äï·Ä∫·Äô·Äæ·ÄØ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, where, onSnapshot, addDoc, doc, updateDoc, deleteDoc, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- ·ÅÅ·Åã Firebase ·ÄÄ·Äô·Äπ·Äò·Ä¨·Äú·ÄØ·Ä∂·Ä∏·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Ä¨ ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä± ---
        let db;
        let auth;
        let userId = null;
        let listenersInitialized = false; // New flag to ensure listeners are set up only once
        
        // --- ·ÅÇ·Åã ·Äú·Äª·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äú·ÄΩ·Äæ·Ä¨ ·ÄÄ·Äô·Äπ·Äò·Ä¨·Äú·ÄØ·Ä∂·Ä∏·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Ä¨ ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä± ---
        let state = {
            approvedApps: [], // ·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫·Äô·Äæ approved ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏
            pendingApps: [], // ·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫·Äô·Äæ pending ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏
            currentView: 'home', // 'home', 'details', 'login', 'admin', 'submit'
            selectedAppId: null,
            searchTerm: '',
            selectedCategory: '·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏',
            isAdmin: false,
            isEditingMode: false,
            editingAppDocId: null,
            isDarkMode: localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches),
            lastSubmittedUser: { name: "", email: "", password: "" },
            isAuthReady: false // Use state variable for general readiness
        };

        const APP_CONTAINER = document.getElementById('app-container');
        const ADMIN_CREDENTIALS = { username: "WaiYan", password: "wai118234" };
        const ALL_CATEGORIES = ['·ÄÄ·Ä≠·Äõ·Ä≠·Äö·Ä¨·Äô·Äª·Ä¨·Ä∏', '·ÄÇ·Ä≠·Äô·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏', '·Äú·Ä∞·Äô·Äæ·ÄØ·ÄÄ·ÄΩ·Äî·Ä∫·Äõ·ÄÄ·Ä∫', '·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ', '·ÄÇ·ÄÆ·Äê', '·Ä°·ÄÅ·Äº·Ä¨·Ä∏'];
        const APPS_COLLECTION_PATH = `artifacts/${appId}/public/data/apps`;
        
        // Firestore logs ·ÄÄ·Ä≠·ÄØ debug level ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äë·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
        setLogLevel('debug');

        // --- ·ÅÉ·Åã Firebase Initialization and Listeners ---
        
        function toggleDarkMode() {
            state.isDarkMode = !state.isDarkMode;
            if (state.isDarkMode) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
            render();
        }

        function initializeTheme() {
            if (state.isDarkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        initializeTheme();

        const initializeFirebase = async () => {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing. Running in limited mode.");
                    state.isAuthReady = true;
                    render();
                    return;
                }

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // --- ·Ä°·ÄÜ·ÄÑ·Ä∑·Ä∫ ·ÅÅ: Authentication ·ÄÄ·Ä≠·ÄØ ·Ä¶·Ä∏·ÄÖ·ÄΩ·Ä¨·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ (Error ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ä±·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫) ---
                try {
                    if (initialAuthToken) {
                        console.log("Signing in with custom token...");
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        // Custom Token ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´·ÄÄ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·Äï·Äª·ÄÄ·Ä∫·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äï·Ä´·ÄÄ Anonymous ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
                        if (!auth.currentUser) {
                            console.log("Signing in anonymously...");
                            await signInAnonymously(auth);
                        }
                    }
                } catch (e) {
                    // Custom token ·Äï·Äª·ÄÄ·Ä∫·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äï·Ä´·ÄÄ Anonymous ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äï·Äº·Äî·Ä∫·Äú·Ää·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
                    console.warn("Custom token sign in failed. Attempting anonymous sign-in...", e);
                    await signInAnonymously(auth);
                }
                
                // --- ·Ä°·ÄÜ·ÄÑ·Ä∑·Ä∫ ·ÅÇ: Auth State Listener ·ÄÄ·Ä≠·ÄØ ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ---
                // onAuthStateChanged ·Äû·Ää·Ä∫ ·Ä°·Äï·Ä±·Ä´·Ä∫·Äô·Äæ sign-in ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äî·Ä±·Ä¨·ÄÄ·Ä∫ ·Åé·ÄÑ·Ä∫·Ä∏·Åè·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠ user object ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÅ·Ä±·Ä´·Ä∫·ÄÜ·Ä≠·ÄØ·Äú·Ä≠·Äô·Ä∑·Ä∫·Äô·Ää·Ä∫·Åã
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        if (!listenersInitialized) {
                            console.log("Auth ready. Setting up Firestore listeners.");
                            listenersInitialized = true;
                            state.isAuthReady = true;
                            setupFirestoreListeners();
                        }
                    } else {
                        console.log("User signed out or failed to sign in.");
                        userId = null;
                        state.isAuthReady = true; // Auth flow finished, even if not signed in
                    }
                    render(); // Render once auth state is finalized
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                state.isAuthReady = true;
                render();
            }
        };

        const setupFirestoreListeners = () => {
            // This function runs only after listenersInitialized is true AND userId is set
            if (!db || !userId) {
                console.error("Cannot set up listeners: DB or User ID is missing.");
                return;
            }

            const appsColRef = collection(db, APPS_COLLECTION_PATH);

            // ·ÅÅ·Åã Approved Apps Listener
            const approvedQuery = query(appsColRef, where("status", "==", "approved"));
            onSnapshot(approvedQuery, (snapshot) => {
                state.approvedApps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            }, (error) => {
                console.error("Error fetching approved apps:", error);
                // Security error in the log should no longer occur if auth flow is correct
            });

            // ·ÅÇ·Åã Pending Apps Listener
            const pendingQuery = query(appsColRef, where("status", "==", "pending"));
            onSnapshot(pendingQuery, (snapshot) => {
                state.pendingApps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render();
            }, (error) => {
                console.error("Error fetching pending apps:", error);
                // Security error in the log should no longer occur if auth flow is correct
            });
        }

        // --- ·ÅÑ·Åã UI Utility Functions (unchanged from previous) ---

        function navigate(view, id = null) {
            state.currentView = view;
            state.selectedAppId = id;
            state.isEditingMode = false; // Reset edit mode on navigation
            state.editingAppDocId = null;
            window.scrollTo(0, 0); 
            render();
        }

        // --- ·ÅÖ·Åã Render Component Functions (Minor changes to use state.approvedApps) ---

        function renderHeader() {
            // ... (Same as previous, using state.approvedApps for category list)
            const allApps = [...state.approvedApps, ...state.pendingApps];
            const categories = ['·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏', ...new Set(allApps.map(app => app.category))];

            return `
                <header class="sticky top-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md shadow-lg rounded-b-3xl mb-4 sm:mb-6 py-3 sm:py-4 border-b border-indigo-200/50 dark:border-slate-700/50">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col justify-between items-center space-y-3">
                        <!-- ·Ä°·Äï·Ä±·Ä´·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Actions -->
                        <div class="flex justify-between w-full items-center">
                            <!-- ·Äú·Ä≠·ÄØ·ÄÇ·Ä≠·ÄØ·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫ -->
                            <div class="flex items-center space-x-2 sm:space-x-3 cursor-pointer" onclick="navigate('home')">
                                <svg class="w-7 h-7 sm:w-9 sm:h-9 text-indigo-600 dark:text-cyan-400 transform rotate-45" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4M17 3v4M3 17h4M18 18h3m-3 0h-3m3 0v3m0-3v-3M18 6h3m-3 0h-3m3 0v3m0-3v-3" /></svg>
                                <h1 class="text-xl sm:text-3xl font-extrabold text-gray-900 dark:text-gray-50">·Äù·Ä±·Äö·Ä∂·Åè ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÖ·Äê·Ä≠·ÄØ·Ä∏</h1>
                            </div>

                            <!-- ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ (Theme, Admin, Submit) -->
                            <div class="flex items-center space-x-3">
                                <!-- App ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ Link -->
                                <button onclick="navigate('submit')" class="px-3 py-1.5 sm:px-4 sm:py-2 bg-green-500 text-white text-xs sm:text-sm font-semibold rounded-full shadow-md hover:bg-green-600 transition duration-150">
                                    ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫
                                </button>
                                <!-- Admin Link -->
                                <button onclick="navigate('login')" class="p-2 sm:p-2.5 text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-cyan-400 hover:bg-gray-100 dark:hover:bg-slate-700 transition duration-150 rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                </button>
                                <!-- Dark Mode Toggle -->
                                <button onclick="toggleDarkMode()" class="p-2 sm:p-2.5 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition duration-150">
                                    ${state.isDarkMode ?
                                        '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>' :
                                        '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>'
                                    }
                                </button>
                            </div>
                        </div>

                        <!-- ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äõ·Ä±·Ä∏·Äò·Ä¨·Ä∏ (·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·Äê·ÄΩ·ÄÑ·Ä∫) -->
                        <div class="w-full">
                            <input
                                type="text"
                                id="search-input"
                                placeholder="·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äï·Ä´..."
                                value="${state.searchTerm}"
                                oninput="handleSearch(this.value)"
                                class="w-full p-2 sm:p-2.5 border-2 border-indigo-200 dark:border-slate-600 rounded-xl focus:ring-cyan-500 focus:border-cyan-500 bg-gray-50 dark:bg-slate-700 text-gray-900 dark:text-gray-50 transition duration-300 shadow-inner"
                            >
                        </div>
                    </div>

                    <!-- ·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏ ·ÄÖ·ÄÖ·Ä∫·Äë·ÄØ·Äê·Ä∫·Äô·Äæ·ÄØ -->
                    ${state.currentView === 'home' ? `
                        <div class="pt-4 pb-2 flex flex-wrap gap-1 justify-center px-2 sm:px-6 lg:px-8 border-t border-indigo-200/50 dark:border-slate-700/50 mt-3">
                            ${categories.map(cat => `
                                <button
                                    onclick="handleCategoryFilter('${cat}')"
                                    class="px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-full transition duration-200 shadow-md ${state.selectedCategory === cat
                                        ? 'bg-indigo-600 text-white transform scale-105 ring-4 ring-indigo-300 dark:ring-cyan-500/50'
                                        : 'bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-gray-300 hover:bg-indigo-100 dark:hover:bg-slate-600'
                                    }"
                                >
                                    ${cat}
                                </button>
                            `).join('')}
                        </div>
                    ` : ''}
                </header>
            `;
        }

        function renderAppCard(app) {
            return `
                <div onclick="navigate('details', '${app.id}')" class="app-card cursor-pointer p-4 sm:p-5 bg-white dark:bg-slate-800 rounded-3xl shadow-xl hover:shadow-2xl hover:scale-[1.01] transition-all duration-300">
                    <div class="flex flex-col items-center text-center space-y-2 sm:space-y-3">
                        <img src="${app.icon}" onerror="this.onerror=null;this.src='https://placehold.co/128x128/cccccc/333333?text=App';" alt="${app.name} Icon" class="w-16 h-16 sm:w-20 sm:h-20 rounded-2xl object-cover shadow-2xl ring-4 ring-indigo-100 dark:ring-slate-700 flex-shrink-0">
                        <div class="min-w-0 flex-1 pt-1 sm:pt-2">
                            <p class="text-lg sm:text-xl font-bold truncate text-gray-900 dark:text-gray-50">${app.name}</p>
                            <p class="text-sm font-medium text-cyan-600 dark:text-cyan-400">${app.category}</p>
                            <div class="mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400 font-semibold">
                                ·Äó·Ä¨·Ä∏·Äõ·Äæ·ÄÑ·Ä∫·Ä∏: ${app.version}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHomePage() {
            const filteredApps = state.approvedApps
                .filter(app => state.selectedCategory === '·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏' || app.category === state.selectedCategory)
                .filter(app => app.name.toLowerCase().includes(state.searchTerm.toLowerCase()));

            return `
                ${renderHeader()}
                <main class="mt-4 sm:mt-8">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-center text-indigo-600 dark:text-cyan-400">·Äë·ÄÑ·Ä∫·Äõ·Äæ·Ä¨·Ä∏·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Äú·ÄÆ·ÄÄ·Ä±·Ä∏·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏</h2>
                    ${!state.isAuthReady ? '<div class="text-center py-12 text-xl text-indigo-600 dark:text-cyan-400">·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫ ·ÄÅ·Äª·Ä≠·Äê·Ä∫·ÄÜ·ÄÄ·Ä∫·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...</div>' : ''}

                    ${filteredApps.length === 0 && state.isAuthReady ? `
                        <div class="text-center py-12 sm:py-16 bg-white dark:bg-slate-800 rounded-2xl shadow-xl mx-4 sm:mx-0">
                            <p class="text-lg sm:text-2xl text-gray-500 dark:text-gray-400 mb-4">·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠ ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äô·Äæ·ÄØ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·ÄÖ·ÄÖ·Ä∫·Äë·ÄØ·Äê·Ä∫·Äô·Äæ·ÄØ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äê·ÄΩ·Ä±·Ä∑·Äï·Ä´·Åã</p>
                            <button onclick="resetFilters()" class="mt-4 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition duration-200 shadow-lg">·ÄÖ·ÄÖ·Ä∫·Äë·ÄØ·Äê·Ä∫·Äô·Äæ·ÄØ·Äô·Äª·Ä¨·Ä∏ ·Äï·Äº·Äî·Ä∫·Äú·Ää·Ä∫·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·Äõ·Äî·Ä∫</button>
                        </div>
                    ` : `
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
                            ${filteredApps.map(renderAppCard).join('')}
                        </div>
                    `}
                </main>
            `;
        }

        function renderAppDetailsPage(app) {
            const screenshots = app.screenshots || [];
            
            window.updateScreenshot = (direction) => {
                const carousel = document.getElementById('screenshot-carousel');
                if (!carousel) return;
                const scrollAmount = carousel.offsetWidth + 16;
                carousel.scrollLeft += direction * scrollAmount;
            };

            return `
                ${renderHeader()}
                <main class="mt-4 sm:mt-8">
                    <button onclick="navigate('home')" class="mb-6 sm:mb-8 inline-flex items-center text-indigo-600 dark:text-cyan-400 hover:text-indigo-800 dark:hover:text-cyan-200 transition duration-150 font-medium text-sm sm:text-base">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 mr-1 sm:mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                        ·Äï·ÄÑ·Ä∫·Äô·ÄÖ·Ä¨·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨·Äû·Ä≠·ÄØ·Ä∑ ·Äï·Äº·Äî·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äõ·Äî·Ä∫
                    </button>

                    <div class="bg-white dark:bg-slate-800 p-6 sm:p-8 rounded-3xl shadow-2xl border border-slate-700/50">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between pb-6 sm:pb-8 border-b border-gray-200 dark:border-slate-700">
                            <div class="flex items-center space-x-4 sm:space-x-6 mb-4 md:mb-0">
                                <img src="${app.icon}" onerror="this.onerror=null;this.src='https://placehold.co/128x128/cccccc/333333?text=App';" alt="${app.name} Icon" class="w-20 h-20 sm:w-24 sm:h-24 rounded-3xl object-cover shadow-xl flex-shrink-0 ring-4 ring-cyan-500/30">
                                <div>
                                    <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-900 dark:text-gray-50">${app.name}</h2>
                                    <p class="text-base sm:text-lg text-gray-500 dark:text-gray-400 mt-1">·Äê·ÄÆ·Äë·ÄΩ·ÄÑ·Ä∫·Äû·Ä∞: <span class="font-semibold text-indigo-600 dark:text-cyan-400">${app.developer}</span></p>
                            </div>
                            </div>
                            <a href="${app.apk}" download="${app.name.replace(/\s/g, '_')}.apk" class="w-full md:w-auto px-6 py-3 sm:px-8 sm:py-4 text-lg sm:text-xl font-bold text-white bg-green-600 rounded-full shadow-lg hover:bg-green-700 transition duration-200 text-center transform hover:scale-[1.02] active:scale-[0.98] mt-4 md:mt-0">
                                APK ·Äí·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Äê·Ä∫·ÄÜ·ÄΩ·Ä≤·Äõ·Äî·Ä∫
                            </a>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 mt-6 sm:mt-8">
                            <div class="bg-gray-50 dark:bg-slate-700 p-5 sm:p-6 rounded-2xl shadow-inner border border-gray-200 dark:border-slate-600 order-2 lg:order-1 h-fit">
                                <h3 class="text-xl sm:text-2xl font-bold mb-5 text-center text-indigo-600 dark:text-cyan-400">·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫</h3>
                                <div class="space-y-4 text-sm sm:text-base">
                                    <div class="flex justify-between items-center border-b pb-2 border-gray-200 dark:border-slate-600">
                                        <span class="font-medium text-gray-500 dark:text-gray-400">·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏:</span>
                                        <span class="font-semibold text-gray-900 dark:text-gray-50">${app.category}</span>
                                    </div>
                                    <div class="flex justify-between items-center border-b pb-2 border-gray-200 dark:border-slate-600">
                                        <span class="font-medium text-gray-500 dark:text-gray-400">·Äó·Ä¨·Ä∏·Äõ·Äæ·ÄÑ·Ä∫·Ä∏:</span>
                                        <span class="font-semibold">${app.version}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium text-gray-500 dark:text-gray-400">·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä°·Äõ·ÄΩ·Äö·Ä∫·Ä°·ÄÖ·Ä¨·Ä∏:</span>
                                        <span class="font-semibold">${app.size}</span>
                                    </div>
                                    <div class="flex justify-between items-center border-t pt-4 border-gray-200 dark:border-slate-600">
                                        <span class="font-medium text-gray-500 dark:text-gray-400">·Äê·ÄÆ·Äë·ÄΩ·ÄÑ·Ä∫·Äû·Ä∞:</span>
                                        <span class="font-semibold text-indigo-600 dark:text-cyan-400">${app.developer}</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Screenshots Carousel -->
                            <div class="order-1 lg:order-2">
                                <h3 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 border-b pb-2 border-indigo-300 dark:border-cyan-700">·ÄÖ·ÄÅ·Äõ·ÄÑ·Ä∫·Äõ·Äæ·Ä±·Ä¨·Ä∑·Äô·Äª·Ä¨·Ä∏</h3>
                                <div class="relative">
                                    <div id="screenshot-carousel" class="flex overflow-x-scroll snap-x snap-mandatory rounded-2xl shadow-3xl space-x-4 aspect-[16/9] border-4 border-gray-200 dark:border-slate-700">
                                        ${screenshots.map((url, index) => `
                                            <img src="${url}" onerror="this.onerror=null;this.src='https://placehold.co/800x450/e5e7eb/4b5563?text=·Äï·ÄØ·Ä∂·Äô·Äõ·Äæ·Ä≠·Äï·Ä´';" alt="Screenshot ${index + 1}" class="w-full flex-shrink-0 snap-center object-contain rounded-xl">
                                        `).join('')}
                                    </div>
                                    ${screenshots.length > 1 ? `
                                        <button onclick="updateScreenshot(-1)" class="absolute top-1/2 left-2 sm:left-4 transform -translate-y-1/2 p-2 sm:p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition duration-150 shadow-xl focus:outline-none">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                                        </button>
                                        <button onclick="updateScreenshot(1)" class="absolute top-1/2 right-2 sm:right-4 transform -translate-y-1/2 p-2 sm:p-3 bg-black/50 text-white rounded-full hover:bg-black/70 transition duration-150 shadow-xl focus:outline-none">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            `;
        }
        
        function renderAdminLoginPage(errorMessage = null) {
            return `
                ${renderHeader()}
                <main class="mt-4 sm:mt-8 max-w-md mx-auto">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-center text-red-600 dark:text-red-400">Admin ·Äú·Ä±·Ä¨·Ä∑·ÄÇ·Ä∫·Ä°·ÄÑ·Ä∫</h2>
                    
                    ${errorMessage ? `<div class="p-4 mb-6 text-sm sm:text-base text-red-800 bg-red-100 dark:bg-red-900 dark:text-red-300 rounded-xl font-medium">${errorMessage}</div>` : ''}

                    <div class="bg-white dark:bg-slate-800 p-6 sm:p-8 rounded-3xl shadow-2xl border-t-8 border-red-500">
                        <form onsubmit="handleAdminLogin(event)">
                            <div class="space-y-4 sm:space-y-6">
                                <div>
                                    <label for="username" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">·Ä°·Äô·Ää·Ä∫</label>
                                    <input type="text" id="username" name="username" required class="w-full p-3 border rounded-xl bg-gray-50 dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Admin Username">
                                </div>
                                <div>
                                    <label for="password" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫</label>
                                    <input type="password" id="password" name="password" required class="w-full p-3 border rounded-xl bg-gray-50 dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Password">
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full mt-8 py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition duration-200 transform hover:scale-[1.01]">
                                ·Äú·Ä±·Ä¨·Ä∑·ÄÇ·Ä∫·Ä°·ÄÑ·Ä∫ ·Äù·ÄÑ·Ä∫·Äõ·Äî·Ä∫
                            </button>
                        </form>
                        <button onclick="navigate('home')" class="w-full mt-4 text-sm text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-cyan-400 transition duration-150">
                            ·Äï·ÄÑ·Ä∫·Äô·ÄÖ·Ä¨·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨·Äû·Ä≠·ÄØ·Ä∑ ·Äï·Äº·Äî·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äõ·Äî·Ä∫
                        </button>
                    </div>
                </main>
            `;
        }

        function renderSubmitPage(message = null) {
            const categories = ALL_CATEGORIES;
            const lastUser = state.lastSubmittedUser;
            
            return `
                ${renderHeader()}
                <main class="mt-4 sm:mt-8 max-w-4xl mx-auto">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 text-center text-green-600 dark:text-green-400">·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äû·ÄÖ·Ä∫ ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫</h2>
                    <p class="text-center text-gray-600 dark:text-gray-400 mb-8 text-sm sm:text-base">
                        ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Åè ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä∞·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Åã (·Ä§·Äí·Ä±·Äê·Ä¨·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äú·Ä≠·ÄØ·Ä°·Äú·Äª·Ä±·Ä¨·ÄÄ·Ä∫ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äô·Ää·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã)
                    </p>

                    ${message ? `<div class="p-4 mb-6 text-sm sm:text-base ${message.type === 'error' ? 'text-red-800 bg-red-100 dark:bg-red-900 dark:text-red-300' : 'text-green-800 bg-green-100 dark:bg-green-900 dark:text-green-300'} rounded-xl font-medium">${message.text}</div>` : ''}

                    <div class="bg-white dark:bg-slate-800 p-6 sm:p-8 rounded-3xl shadow-2xl border-t-8 border-green-500">
                        <form id="submit-app-form" onsubmit="handleAppSubmission(event)">
                            
                            <h3 class="text-xl sm:text-2xl font-bold mb-4 text-indigo-600 dark:text-cyan-400">·ÅÅ·Åã ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä∞ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫ (·Äô·Äõ·Äæ·Ä≠·Äô·Äñ·Äº·ÄÖ·Ä∫·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6 mb-8 border p-4 rounded-xl dark:border-slate-700 bg-gray-50 dark:bg-slate-700/50">
                                <div>
                                    <label for="submitterName" class="block text-sm font-medium mb-1">·Ä°·Äô·Ää·Ä∫*</label>
                                    <input type="text" id="submitterName" name="submitterName" value="${lastUser.name || ''}" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞·Ä°·Äô·Ää·Ä∫">
                                </div>
                                <div>
                                    <label for="submitterEmail" class="block text-sm font-medium mb-1">·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫*</label>
                                    <input type="email" id="submitterEmail" name="submitterEmail" value="${lastUser.email || ''}" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="example@gmail.com">
                                </div>
                                <div>
                                    <label for="submitterPassword" class="block text-sm font-medium mb-1">·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫* (Admin ·Äô·Äº·ÄÑ·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ää·Ä∫)</label>
                                    <input type="password" id="submitterPassword" name="submitterPassword" value="${lastUser.password || ''}" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="·Äú·Äª·Äæ·Ä≠·ÄØ·Ä∑·Äù·Äæ·ÄÄ·Ä∫·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫">
                                </div>
                            </div>
                            
                            <h3 class="text-xl sm:text-2xl font-bold mb-4 text-indigo-600 dark:text-cyan-400">·ÅÇ·Åã ·Ä°·ÄÄ·Ä∫·Äï·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                                <div>
                                    <label for="name" class="block text-sm font-medium mb-1">·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äô·Ää·Ä∫*</label>
                                    <input type="text" id="name" name="name" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="App Name">
                                </div>
                                <div>
                                    <label for="developer" class="block text-sm font-medium mb-1">·Äê·ÄÆ·Äë·ÄΩ·ÄÑ·Ä∫·Äû·Ä∞*</label>
                                    <input type="text" id="developer" name="developer" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="Developer Name">
                                </div>
                                <div>
                                    <label for="category" class="block text-sm font-medium mb-1">·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏*</label>
                                    <select id="category" name="category" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm">
                                        <option value="" disabled selected>·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Ä´</option>
                                        ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label for="version" class="block text-sm font-medium mb-1">·Äó·Ä¨·Ä∏·Äõ·Äæ·ÄÑ·Ä∫·Ä∏*</label>
                                    <input type="text" id="version" name="version" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="1.0.0">
                                </div>
                                <div>
                                    <label for="size" class="block text-sm font-medium mb-1">·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä°·Äõ·ÄΩ·Äö·Ä∫·Ä°·ÄÖ·Ä¨·Ä∏ (·Ä•·Äï·Äô·Ä¨- 50 MB)*</label>
                                    <input type="text" id="size" name="size" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="12 MB">
                                </div>
                                <div>
                                    <label for="icon" class="block text-sm font-medium mb-1">·Ä°·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·ÄΩ·Äî·Ä∫ URL (·Äï·Äº·ÄÑ·Ä∫·Äï·Äú·ÄÑ·Ä∑·Ä∫·ÄÅ·Ä∫)*</label>
                                    <input type="url" id="icon" name="icon" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="https://example.com/icon.png">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="apk" class="block text-sm font-medium mb-1">APK ·Äí·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Äê·Ä∫ URL (·Äï·Äº·ÄÑ·Ä∫·Äï·Äú·ÄÑ·Ä∑·Ä∫·ÄÅ·Ä∫)*</label>
                                    <input type="url" id="apk" name="apk" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="https://example.com/app.apk">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="screenshots" class="block text-sm font-medium mb-1">·ÄÖ·ÄÅ·Äõ·ÄÑ·Ä∫·Äõ·Äæ·Ä±·Ä¨·Ä∑ URL ·Äô·Äª·Ä¨·Ä∏ (·ÄÄ·Ä±·Ä¨·Ä∫·Äô·Ä¨·ÄÅ·Äº·Ä¨·Ä∏·Äï·Äº·ÄÆ·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´)*</label>
                                    <textarea id="screenshots" name="screenshots" rows="3" required class="w-full p-3 border rounded-xl bg-white dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="https://example.com/sc1.jpg, https://example.com/sc2.jpg"></textarea>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full mt-8 py-3 bg-green-600 text-white font-bold rounded-xl shadow-lg hover:bg-green-700 transition duration-200 transform hover:scale-[1.01]">
                                ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫
                            </button>
                        </form>
                    </div>
                </main>
            `;
        }

        function renderAdminPanel() {
            const allAppsHtml = state.approvedApps.map(app => `
                <div class="flex justify-between items-center p-3 border-b border-gray-100 dark:border-slate-700 hover:bg-indigo-50/20 dark:hover:bg-slate-700 transition duration-200 rounded-lg">
                    <div class="flex items-center space-x-3 min-w-0 flex-1">
                        <img src="${app.icon}" onerror="this.onerror=null;this.src='https://placehold.co/40x40/cccccc/333333?text=A';" class="w-8 h-8 rounded-lg flex-shrink-0 shadow-md">
                        <div class="min-w-0">
                            <span class="font-medium truncate block text-sm">${app.name}</span>
                            <span class="text-xs text-cyan-600 dark:text-cyan-400">${app.category}</span>
                        </div>
                    </div>
                    <div class="space-x-3 flex flex-shrink-0">
                        <button onclick="editAppForm('${app.id}')" class="p-1 text-indigo-600 hover:text-cyan-600 dark:text-cyan-400 dark:hover:text-cyan-200 transition duration-150 rounded-full hover:bg-gray-200/50 dark:hover:bg-slate-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                        </button>
                        <button onclick="deleteApp('${app.id}')" class="p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200 transition duration-150 rounded-full hover:bg-gray-200/50 dark:hover:bg-slate-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                </div>
            `).join('');

            const pendingAppsHtml = state.pendingApps.map(app => `
                <div class="p-4 bg-yellow-50 dark:bg-yellow-900/50 border border-yellow-200 dark:border-yellow-800 rounded-xl mb-4 shadow-md">
                    <p class="font-bold text-lg mb-2 text-yellow-800 dark:text-yellow-200">${app.name} (v${app.version})</p>
                    <div class="text-sm space-y-1 mb-3 text-yellow-700 dark:text-yellow-300">
                        <p><strong>·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä∞-</strong> ${app.submitterName || 'N/A'}</p>
                        <p><strong>·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫-</strong> ${app.submitterEmail || 'N/A'}</p>
                        <p><strong>·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫-</strong> <span class="font-mono text-xs bg-yellow-200 dark:bg-yellow-800 p-1 rounded">${app.submitterPassword || 'N/A'}</span></p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="approveApp('${app.id}')" class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition duration-150 shadow">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äõ·Äî·Ä∫</button>
                        <button onclick="deleteApp('${app.id}')" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition duration-150 shadow">·Äï·Äö·Ä∫·ÄÅ·Äª·Äõ·Äî·Ä∫ (·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫)</button>
                        <button onclick="navigate('details', '${app.id}')" class="px-4 py-2 bg-indigo-500 text-white text-sm font-medium rounded-lg hover:bg-indigo-600 transition duration-150 shadow">·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫</button>
                    </div>
                </div>
            `).join('');

            const editApp = state.approvedApps.find(a => a.id === state.editingAppDocId) || {};
            const formTitle = state.isEditingMode ? `·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äõ·Äî·Ä∫: ${editApp.name || 'N/A'}` : '·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫ (Admin)';
            const buttonText = state.isEditingMode ? '·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äï·Ä∫·Äí·Ä≠·Äê·Ä∫·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫' : '·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫';

            return `
                ${renderHeader()}
                <main class="mt-4 sm:mt-8">
                    <h2 class="text-3xl sm:text-4xl font-extrabold mb-6 sm:mb-8 text-center text-indigo-600 dark:text-cyan-400">·Ä°·ÄÄ·Ä∫·Äô·ÄÑ·Ä∫ ·Äë·Ä≠·Äî·Ä∫·Ä∏·ÄÅ·Äª·ÄØ·Äï·Ä∫·Äô·Äæ·ÄØ</h2>
                    <div class="p-4 mb-8 bg-indigo-50 dark:bg-slate-700/50 rounded-xl border border-indigo-200 dark:border-slate-700">
                        <p class="text-base font-semibold text-indigo-700 dark:text-cyan-400">üî• ·Ä°·Äõ·Ä±·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏·Äû·Ää·Ä∫·Åã: ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ Firestore ·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äú·Ä≠·ÄØ·Ä°·Äú·Äª·Ä±·Ä¨·ÄÄ·Ä∫ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äû·Ää·Ä∫·Åã JSON ·ÄÄ·Ä≠·ÄØ ·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äê·Ä≠·ÄØ·ÄÑ·Ä∫ ·ÄÄ·Ä∞·Ä∏·Äö·Ä∞·Äõ·Äî·Ä∫ ·Äô·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äê·Ä±·Ä¨·Ä∑·Äï·Ä´·Åã</p>
                    </div>

                    <!-- ·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏ -->
                    <div class="bg-yellow-100 dark:bg-slate-700/50 p-6 sm:p-8 rounded-3xl shadow-xl mb-8 border border-yellow-400 dark:border-yellow-700">
                        <h3 class="text-2xl sm:text-3xl font-bold mb-4 text-yellow-800 dark:text-yellow-300">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ (${state.pendingApps.length})</h3>
                        ${state.pendingApps.length === 0 ? 
                            '<p class="text-yellow-700 dark:text-yellow-400">·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´·Åã</p>' : 
                            `<div class="max-h-96 overflow-y-auto space-y-2 pr-2">${pendingAppsHtml}</div>`
                        }
                    </div>


                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
                        
                        <!-- ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫/·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äñ·Ä±·Ä¨·ÄÑ·Ä∫ -->
                        <div class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 sm:p-8 rounded-3xl shadow-xl border-t-4 border-indigo-500 order-2 lg:order-1">
                            <h3 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 border-b pb-2 text-gray-900 dark:text-gray-50">${formTitle}</h3>
                            <form id="app-form" onsubmit="handleAdminFormSubmit(event)">
                                <input type="hidden" name="id" value="${editApp.id || ''}">

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                                    ${['name', 'developer', 'version', 'size', 'icon', 'apk', 'screenshots'].map(field => {
                                        let type = (field === 'icon' || field === 'apk') ? 'url' : 'text';
                                        let label = '';
                                        let placeholder = '';
                                        let value = editApp[field] || '';

                                        if (field === 'name') { label = '·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äô·Ää·Ä∫'; placeholder = 'App Name'; }
                                        else if (field === 'developer') { label = '·Äê·ÄÆ·Äë·ÄΩ·ÄÑ·Ä∫·Äû·Ä∞'; placeholder = 'Developer Name'; }
                                        else if (field === 'version') { label = '·Äó·Ä¨·Ä∏·Äõ·Äæ·ÄÑ·Ä∫·Ä∏'; placeholder = '1.0.0'; }
                                        else if (field === 'size') { label = '·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä°·Äõ·ÄΩ·Äö·Ä∫·Ä°·ÄÖ·Ä¨·Ä∏ (·Ä•·Äï·Äô·Ä¨- 50 MB)'; placeholder = '12 MB'; }
                                        else if (field === 'icon') { label = '·Ä°·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·ÄΩ·Äî·Ä∫ URL'; placeholder = 'https://example.com/icon.png'; }
                                        else if (field === 'apk') { label = 'APK ·Äí·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Äê·Ä∫ URL'; placeholder = 'https://example.com/app.apk'; }
                                        else if (field === 'screenshots') { 
                                            label = '·ÄÖ·ÄÅ·Äõ·ÄÑ·Ä∫·Äõ·Äæ·Ä±·Ä¨·Ä∑ URL ·Äô·Äª·Ä¨·Ä∏ (·ÄÄ·Ä±·Ä¨·Ä∫·Äô·Ä¨·ÄÅ·Äº·Ä¨·Ä∏·Äï·Äº·ÄÆ·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´)'; 
                                            placeholder = 'https://example.com/sc1.jpg, https://example.com/sc2.jpg'; 
                                            value = Array.isArray(value) ? value.join(', ') : value;
                                            return `<div class="md:col-span-2">
                                                <label for="${field}" class="block text-sm font-medium">${label}</label>
                                                <textarea id="${field}" name="${field}" rows="4" required class="w-full p-3 border rounded-xl bg-gray-50 dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="${placeholder}">${value}</textarea>
                                            </div>`;
                                        }

                                        return `
                                            <div>
                                                <label for="${field}" class="block text-sm font-medium">${label}</label>
                                                <input type="${type}" id="${field}" name="${field}" value="${value}" required class="w-full p-3 border rounded-xl bg-gray-50 dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm" placeholder="${placeholder}">
                                            </div>
                                        `;
                                    }).join('')}
                                    
                                    <div>
                                        <label for="category" class="block text-sm font-medium">·Ä°·Äô·Äª·Ä≠·ÄØ·Ä∏·Ä°·ÄÖ·Ä¨·Ä∏</label>
                                        <select id="category" name="category" required class="w-full p-3 border rounded-xl bg-gray-50 dark:bg-slate-700 dark:border-slate-600 focus:ring-cyan-500 focus:border-cyan-500 shadow-sm">
                                            ${ALL_CATEGORIES.map(cat => `<option value="${cat}" ${editApp.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                        </select>
                                    </div>
                                </div>

                                <div class="flex flex-col sm:flex-row justify-between items-center mt-6 sm:mt-8 space-y-3 sm:space-y-0">
                                    <button type="submit" class="w-full sm:w-auto px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition duration-200 transform hover:scale-[1.01]">
                                        ${buttonText}
                                    </button>
                                    ${state.isEditingMode ? `<button type="button" onclick="cancelEdit()" class="w-full sm:w-auto px-6 py-3 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-slate-600 rounded-xl hover:bg-gray-300 dark:hover:bg-slate-500 transition duration-150">·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Äñ·Äª·ÄÄ·Ä∫·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Äî·Ä∫</button>` : ''}
                                </div>
                            </form>
                        </div>

                        <!-- ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏ -->
                        <div class="lg:col-span-1 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-xl h-fit border border-gray-100 dark:border-slate-700 order-1 lg:order-2">
                            <h3 class="text-xl sm:text-2xl font-bold mb-4 border-b pb-2 text-indigo-600 dark:text-cyan-400">·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ (${state.approvedApps.length})</h3>
                            <div class="max-h-96 overflow-y-auto space-y-2 pr-2">
                                ${state.approvedApps.length === 0 ? '<p class="text-gray-500">·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠ ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´·Åã</p>' : allAppsHtml}
                            </div>
                        </div>
                    </div>
                </main>
            `;
        }


        // --- ·ÅÜ·Åã Event Handlers (Firestore CRUD Operations) ---

        function handleSearch(term) {
            state.searchTerm = term;
            state.selectedCategory = '·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏';
            render();
        }

        function handleCategoryFilter(category) {
            state.selectedCategory = category;
            state.searchTerm = '';
            document.getElementById('search-input').value = '';
            render();
        }

        function resetFilters() {
            state.searchTerm = '';
            state.selectedCategory = '·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏';
            render();
        }

        function handleAdminLogin(event) {
            event.preventDefault();
            const form = event.target;
            const username = form.username.value;
            const password = form.password.value;

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                state.isAdmin = true;
                navigate('admin');
            } else {
                // Custom modal UI should be used here instead of window.confirm
                render(renderAdminLoginPage('·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞·Ä°·Äô·Ää·Ä∫ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫ ·Äô·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·Äï·Ä´·Åã'));
            }
        }
        
        async function handleAppSubmission(event) {
            event.preventDefault();
            if (!db) return alert("·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫ ·ÄÅ·Äª·Ä≠·Äê·Ä∫·ÄÜ·ÄÄ·Ä∫·Äô·Äæ·ÄØ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åä ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ ·Äë·Äï·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´·Åã"); 

            const form = event.target;
            
            // ·ÅÅ·Åã ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä∞ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫
            const submitterName = form.submitterName.value.trim();
            const submitterEmail = form.submitterEmail.value.trim();
            const submitterPassword = form.submitterPassword.value;

            // ·ÅÇ·Åã ·Ä°·ÄÄ·Ä∫·Äï·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫
            const newApp = {
                name: form.name.value.trim(),
                icon: form.icon.value.trim(),
                screenshots: form.screenshots.value.split(',').map(s => s.trim()).filter(s => s),
                category: form.category.value,
                version: form.version.value.trim(),
                size: form.size.value.trim(),
                developer: form.developer.value.trim(),
                apk: form.apk.value.trim(),
                
                // Firestore-specific fields
                status: 'pending', // Pending for admin approval
                submitterName: submitterName,
                submitterEmail: submitterEmail,
                submitterPassword: submitterPassword,
                createdAt: new Date().toISOString()
            };
            
            // Validation
            if (!submitterName || !submitterEmail || !submitterPassword || 
                !newApp.name || !newApp.icon || !newApp.category || !newApp.apk) {
                render(renderSubmitPage({
                    type: 'error', 
                    text: '·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äû·Ä±·Ä¨·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Åã'
                }));
                return;
            }

            try {
                // Add to Firestore
                await addDoc(collection(db, APPS_COLLECTION_PATH), newApp);
                
                // Save last submitted user info for auto-fill
                state.lastSubmittedUser = { name: submitterName, email: submitterEmail, password: submitterPassword };

                // Form ·ÄÄ·Ä≠·ÄØ ·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·Äú·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏ Message ·Äï·Äº·Äû
                form.reset();
                render(renderSubmitPage({
                    type: 'success', 
                    text: `${newApp.name} ·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨ ·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã Admin ·Åè ·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´·Åã`
                }));

            } catch (error) {
                console.error("Error submitting app:", error);
                render(renderSubmitPage({
                    type: 'error', 
                    text: `·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äô·Äæ·ÄØ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã Error: ${error.message}`
                }));
            }
        }

        function editAppForm(docId) {
            state.editingAppDocId = docId;
            state.isEditingMode = true;
            render();
        }

        function cancelEdit() {
            state.editingAppDocId = null;
            state.isEditingMode = false;
            render();
        }

        async function handleAdminFormSubmit(event) {
            event.preventDefault();
            if (!db) return;

            const form = event.target;
            const docId = form.id.value;
            const isUpdate = state.isEditingMode && docId;

            const appData = {
                name: form.name.value.trim(),
                icon: form.icon.value.trim(),
                screenshots: form.screenshots.value.split(',').map(s => s.trim()).filter(s => s),
                category: form.category.value,
                version: form.version.value.trim(),
                size: form.size.value.trim(),
                developer: form.developer.value.trim(),
                apk: form.apk.value.trim(),
                status: 'approved', // Always approve from this form
            };

            try {
                if (isUpdate) {
                    await updateDoc(doc(db, APPS_COLLECTION_PATH, docId), appData);
                } else {
                    // Add new approved app
                    appData.createdAt = new Date().toISOString();
                    await addDoc(collection(db, APPS_COLLECTION_PATH), appData);
                }
                
                // Clear form state
                state.editingAppDocId = null;
                state.isEditingMode = false;
                
                // Custom modal UI should be used here instead of window.confirm
                window.confirm(`·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ${isUpdate ? '·Ä°·Äï·Ä∫·Äí·Ä≠·Äê·Ä∫·Äú·ÄØ·Äï·Ä∫' : '·Ä°·Äû·ÄÖ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏'} ·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ!`);
                render();

            } catch (error) {
                 console.error("Error submitting admin form:", error);
                 window.confirm(`·Ä°·ÄÄ·Ä∫·Äï·Ä∫·Ä°·Äï·Ä∫·Äí·Ä≠·Äê·Ä∫·Äú·ÄØ·Äï·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã Error: ${error.message}`);
            }
        }

        async function deleteApp(docId) {
            // Custom modal UI should be used here instead of window.confirm
            const confirmed = window.confirm('·Ä§·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Äí·Ä±·Äê·Ä¨·Äò·Ä±·Ä∑·ÄÖ·Ä∫·Äô·Äæ ·Ä°·Äï·Äº·ÄÆ·Ä∏·Ä°·Äï·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏·Åã');

            if (confirmed && db) {
                try {
                    await deleteDoc(doc(db, APPS_COLLECTION_PATH, docId));
                    // onSnapshot will handle the UI update
                } catch (error) {
                    console.error("Error deleting app:", error);
                    window.confirm(`·Äñ·Äª·ÄÄ·Ä∫·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã Error: ${error.message}`);
                }
            }
        }
        
        async function approveApp(docId) {
            if (!db) return;
            // Custom modal UI should be used here instead of window.confirm
            const confirmed = window.confirm('·Ä§·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äõ·Äî·Ä∫ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏·Åã');

            if (confirmed) {
                try {
                    // Update the status field
                    await updateDoc(doc(db, APPS_COLLECTION_PATH, docId), {
                        status: 'approved',
                        // submitterName: deleteField(), // Cannot use deleteField with this CDN import
                        // submitterEmail: deleteField(),
                        // submitterPassword: deleteField()
                    });
                    // onSnapshot will handle the UI update
                    window.confirm(`·Ä°·ÄÄ·Ä∫·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã`);
                } catch (error) {
                    console.error("Error approving app:", error);
                    window.confirm(`·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã Error: ${error.message}`);
                }
            }
        }
        
        // --- ·Åá·Åã ·Äï·ÄÑ·Ä∫·Äô ·Äï·Äº·Äû·Äô·Äæ·ÄØ ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫ ---
        
        function render(content = null) {
            let htmlContent = '';
            
            // Loading State
            if (!state.isAuthReady || (state.isAuthReady && !listenersInitialized)) {
                APP_CONTAINER.innerHTML = `
                    ${renderHeader()}
                    <div class="flex flex-col items-center justify-center h-96">
                        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
                        <p class="mt-4 text-xl text-indigo-600 dark:text-cyan-400">·ÄÖ·Äî·ÄÖ·Ä∫ ·ÄÖ·Äê·ÄÑ·Ä∫·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...</p>
                    </div>
                `;
                return;
            }

            let app = null;

            switch (state.currentView) {
                case 'home':
                    htmlContent = renderHomePage();
                    break;
                case 'details':
                    const allApps = [...state.approvedApps, ...state.pendingApps];
                    app = allApps.find(a => a.id === state.selectedAppId);
                    if (app) {
                        htmlContent = renderAppDetailsPage(app);
                    } else {
                        navigate('home');
                    }
                    break;
                case 'login':
                    htmlContent = content !== null ? content : renderAdminLoginPage();
                    break;
                case 'admin':
                    if (state.isAdmin) {
                        htmlContent = renderAdminPanel();
                    } else {
                        navigate('login');
                    }
                    break;
                case 'submit':
                    htmlContent = content !== null ? content : renderSubmitPage();
                    break;
                default:
                    htmlContent = renderHomePage();
            }

            APP_CONTAINER.innerHTML = htmlContent;
        }

        // --- ·Åà·Åã Global Functions (HTML ·Äê·ÄΩ·ÄÑ·Ä∫ ·Äû·ÄØ·Ä∂·Ä∏·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äî·Ä∫) ---
        window.navigate = navigate;
        window.handleSearch = handleSearch;
        window.handleCategoryFilter = handleCategoryFilter;
        window.toggleDarkMode = toggleDarkMode;
        window.handleAdminLogin = handleAdminLogin;
        window.handleAdminFormSubmit = handleAdminFormSubmit;
        window.handleAppSubmission = handleAppSubmission;
        window.editAppForm = editAppForm;
        window.deleteApp = deleteApp;
        window.cancelEdit = cancelEdit;
        window.resetFilters = resetFilters;
        window.approveApp = approveApp;

        // ·ÄÖ·Äê·ÄÑ·Ä∫·Äï·Äº·Äû·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
        document.addEventListener('DOMContentLoaded', initializeFirebase);

    </script>
</body>
</html>
